# 删除 spawn_agent 功能需求文档

## 项目背景

当前系统同时提供了 `spawn_agent` 和 `spawn_agent_with_task` 两个工具。`spawn_agent_with_task` 是更优的解决方案，因为它将创建智能体和发送任务消息合并为一个原子操作，减少了工具调用次数和大模型调用次数。

## 需求概述

全面删除 `spawn_agent` 功能，保留并优化 `spawn_agent_with_task`。这是一个破坏性变更，不考虑向后兼容性。

## 用户故事

### 故事 1：开发者使用统一的智能体创建接口
**作为** 系统开发者  
**我希望** 只有一个创建智能体的工具接口  
**以便** 简化API设计，避免混淆  

**验收标准：**
- 系统中不再存在 `spawn_agent` 工具
- 所有智能体创建都通过 `spawn_agent_with_task` 完成
- 工具列表中只显示 `spawn_agent_with_task`

### 故事 2：智能体创建更高效
**作为** 智能体  
**我希望** 创建子智能体时能一次性完成创建和任务分配  
**以便** 减少通信开销，提高执行效率  

**验收标准：**
- 创建智能体时必须同时提供初始任务
- 不再需要先创建再发送消息的两步操作
- 减少了一次工具调用和一次大模型调用

### 故事 3：代码库清理
**作为** 系统维护者  
**我希望** 删除所有 `spawn_agent` 相关代码  
**以便** 简化代码库，减少维护负担  

**验收标准：**
- 删除 `spawn_agent` 工具定义
- 删除 `_executeSpawnAgent` 方法实现
- 删除所有相关测试用例
- 更新所有文档和提示词

## 功能需求

### FR1: 删除 spawn_agent 工具
- 从工具定义中移除 `spawn_agent`
- 删除 `_executeSpawnAgent` 方法
- 更新工具权限配置

### FR2: 更新测试用例
- 删除所有 `spawn_agent` 相关测试
- 将测试逻辑迁移到 `spawn_agent_with_task`
- 确保测试覆盖率不降低

### FR3: 更新文档
- 从所有文档中删除 `spawn_agent` 引用
- 更新工具使用说明
- 更新示例代码

### FR4: 更新提示词
- 从提示词模板中删除 `spawn_agent` 说明
- 强调使用 `spawn_agent_with_task`

## 非功能需求

### NFR1: 性能优化
- 删除后系统响应更快（减少工具调用）
- 内存占用更少（删除冗余代码）

### NFR2: 代码质量
- 代码库更简洁
- API设计更一致
- 维护成本更低

## 约束条件

1. **破坏性变更**：不考虑向后兼容性
2. **全面删除**：不保留任何 `spawn_agent` 相关代码
3. **测试完整性**：确保删除后所有测试通过
4. **文档同步**：所有文档必须同步更新

## 验收标准

### 代码层面
- [ ] 搜索 `spawn_agent` 不返回任何结果（除了 `spawn_agent_with_task`）
- [ ] 所有测试用例通过
- [ ] 工具列表中不包含 `spawn_agent`

### 功能层面
- [ ] 智能体创建功能正常工作
- [ ] 系统启动无错误
- [ ] 现有功能不受影响

### 文档层面
- [ ] 所有文档更新完成
- [ ] 示例代码使用 `spawn_agent_with_task`
- [ ] 提示词模板更新

## 风险评估

### 高风险
- 现有测试用例可能大量失败
- 可能存在遗漏的引用导致运行时错误

### 中风险
- 文档更新可能不完整
- 提示词可能需要多次调整

### 低风险
- 核心功能逻辑不变
- `spawn_agent_with_task` 已经稳定运行

## 实施计划

1. **阶段1**：代码删除
   - 删除工具定义和实现
   - 更新工具权限配置

2. **阶段2**：测试更新
   - 删除相关测试用例
   - 迁移必要的测试逻辑

3. **阶段3**：文档更新
   - 更新所有文档文件
   - 更新示例代码

4. **阶段4**：验证测试
   - 运行完整测试套件
   - 验证系统功能正常