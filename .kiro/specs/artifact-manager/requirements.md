# 需求文档：工件管理器

## 介绍

工件管理器是一个基于网页的界面，用于查看、搜索、过滤和检查由Agent Society系统中的智能体生成的工件。它为不同的文件类型（JSON、文本、图片）提供专门的查看器，并针对每种格式进行了性能优化和用户体验优化。

## 术语表

- **工件（Artifact）**: 由智能体生成的文件，存储在工件存储中并带有元数据
- **工件管理器（Artifact_Manager）**: 用于浏览和查看工件的网页界面组件
- **JSON查看器（JSON_Viewer）**: 用于显示JSON工件的专门组件，支持树状视图和字符串截断
- **文本查看器（Text_Viewer）**: 用于显示纯文本工件的组件
- **图片查看器（Image_Viewer）**: 用于显示图片工件的组件，支持缩略图和灯箱
- **过滤（Filter）**: 按文件扩展名或其他属性缩小工件列表的条件
- **搜索（Search）**: 基于文本的查询，用于按名称查找工件
- **字符串截断（Truncation）**: 限制字符串显示长度以防止性能下降
- **树状视图（Tree_View）**: JSON对象结构的分层显示
- **消息ID（Message_ID）**: 生成工件的消息的唯一标识符

## 需求

### 需求1：工件发现和显示

**用户故事：** 作为智能体开发者，我想查看智能体生成的所有工件，以便检查和调试智能体的输出。

#### 验收标准

1. 当工件管理器加载时，系统应显示来自工件存储的所有可用工件列表
2. 当显示工件时，系统应显示工件元数据，包括文件名、创建日期和文件大小
3. 当工件列表为空时，系统应显示一条消息，表示没有可用的工件
4. 当选择工件时，系统应加载工件并使用适当的查看器显示它

_需求: 1.1, 1.2, 1.3, 1.4_

### 需求2：工件过滤

**用户故事：** 作为智能体开发者，我想按文件扩展名过滤工件，以便专注于特定的工件类型。

#### 验收标准

1. 当工件管理器显示工件时，系统应提供按文件扩展名过滤的界面
2. 当应用文件扩展名过滤时，系统应仅显示与所选扩展名匹配的工件
3. 当选择多个扩展名时，系统应显示与任何选定扩展名匹配的工件
4. 当清除过滤时，系统应再次显示所有工件
5. 当没有工件与过滤条件匹配时，系统应显示一条消息，表示没有匹配的工件

_需求: 2.1, 2.2, 2.3, 2.4, 2.5_

### 需求3：工件搜索

**用户故事：** 作为智能体开发者，我想按名称搜索工件，以便快速定位特定的工件。

#### 验收标准

1. 当工件管理器显示工件时，系统应提供搜索输入字段
2. 当输入搜索查询时，系统应按文件名匹配过滤工件
3. 当显示搜索结果时，系统应高亮显示文件名中的匹配部分
4. 当清除搜索字段时，系统应显示所有工件（遵守活跃的过滤条件）
5. 当没有工件与搜索查询匹配时，系统应显示一条消息，表示没有匹配的工件

_需求: 3.1, 3.2, 3.3, 3.4, 3.5_

### 需求4：JSON工件查看器

**用户故事：** 作为智能体开发者，我想以格式化的树状结构查看JSON工件，以便轻松检查复杂的JSON数据。

#### 验收标准

1. 当选择JSON工件时，系统应解析并将其显示为格式化的树状视图
2. 当显示JSON时，系统应显示对象键和值，并具有适当的缩进
3. 当JSON值是字符串时，系统应截断长度超过100个字符的字符串，并显示省略号指示符
4. 当鼠标悬停在截断的字符串上时，系统应在工具提示中显示完整字符串
5. 当展开/折叠JSON节点时，系统应切换子节点的可见性
6. 当右键单击JSON对象或字段时，系统应提供包含复制选项的上下文菜单
7. 当选择"复制对象"时，系统应将整个JSON对象复制到剪贴板
8. 当选择"复制字段名"时，系统应将字段名复制到剪贴板
9. 当选择"复制字段值"时，系统应将字段值复制到剪贴板

_需求: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9_

### 需求5：文本工件查看器

**用户故事：** 作为智能体开发者，我想直接查看纯文本工件，以便读取基于文本的输出。

#### 验收标准

1. 当选择文本工件时，系统应将文件内容显示为纯文本
2. 当显示文本时，系统应保留格式，包括换行符和缩进
3. 当文本内容非常大时，系统应实现虚拟化以保持性能
4. 当显示文本时，系统应提供行号以供参考
5. 当用户选择文本时，系统应允许将选定的文本复制到剪贴板

_需求: 5.1, 5.2, 5.3, 5.4, 5.5_

### 需求6：图片工件查看器

**用户故事：** 作为智能体开发者，我想使用缩略图和全尺寸预览查看图片工件，以便检查生成的图片。

#### 验收标准

1. 当选择图片工件时，系统应显示图片的缩略图
2. 当单击缩略图时，系统应打开灯箱显示全尺寸图片
3. 当在灯箱中显示图片时，系统应提供缩放控件（放大、缩小、适应窗口）
4. 当显示图片时，系统应显示图片元数据，包括尺寸和文件大小
5. 当灯箱打开时，系统应允许通过单击图片外部或按Escape键关闭它
6. 当工件列表中有多个图片时，系统应允许在灯箱中的图片之间导航

_需求: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

### 需求7：工件查看器选择

**用户故事：** 作为智能体开发者，我想系统根据文件类型自动选择适当的查看器，以便我不需要手动选择查看器。

#### 验收标准

1. 当选择工件时，系统应从文件扩展名确定文件类型
2. 当文件扩展名为.json时，系统应使用JSON查看器
3. 当文件扩展名为.txt时，系统应使用文本查看器
4. 当文件扩展名为.md时，系统应使用文本查看器
5. 当文件扩展名为图片格式（.png、.jpg、.jpeg、.gif、.webp）时，系统应使用图片查看器
6. 当文件扩展名无法识别时，系统应显示一条消息，表示不支持该文件类型

_需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6_

### 需求8：性能优化

**用户故事：** 作为系统架构师，我想工件管理器能够高效处理大型工件，以便UI保持响应。

#### 验收标准

1. 当显示JSON工件时，系统应截断长字符串以防止DOM膨胀
2. 当文本工件非常大时，系统应使用虚拟化仅渲染可见内容
3. 当工件列表很大时，系统应实现分页或延迟加载
4. 当过滤或搜索工件时，系统应在客户端执行过滤，不阻塞UI
5. 当显示图片时，系统应异步加载缩略图，不阻塞主线程

_需求: 8.1, 8.2, 8.3, 8.4, 8.5_

### 需求9：工件源追踪

**用户故事：** 作为智能体开发者，我想将工件追踪回其源消息，以便理解工件是如何生成的。

#### 验收标准

1. 当创建工件时，系统应记录生成工件的消息ID
2. 当在工件管理器中显示工件时，系统应显示"查看来源"按钮
3. 当单击"查看来源"按钮时，系统应导航到对话视图，显示源消息
4. 当显示源消息时，系统应高亮或聚焦生成工件的消息
5. 如果工件是在没有消息ID的情况下生成的，系统应禁用"查看来源"按钮并显示工具提示说明原因

_需求: 9.1, 9.2, 9.3, 9.4, 9.5_
