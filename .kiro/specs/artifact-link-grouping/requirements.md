# 工件链接分组显示功能需求文档

## 1. 功能概述

在聊天面板中，当显示工件链接时，需要根据工件的元数据（MIME类型）将链接分组显示，并为不同类型的工件提供不同的展示方式。

## 2. 用户故事

### 2.1 作为用户，我希望看到图片工件的缩略图
**验收标准：**
- 当工件是图片类型时，显示缩略图而不是纯文本链接
- 缩略图可点击，点击后打开工件管理器查看完整图片
- 缩略图加载失败时显示占位图标

### 2.2 作为用户，我希望知道哪些工件可以在工件管理器中打开
**验收标准：**
- 可在工件管理器中打开的工件显示为可点击链接，显示工件名
- 链接样式与不可打开的工件有明显区别
- 点击链接后打开工件管理器并显示工件内容

### 2.3 作为用户，我希望知道哪些工件只能下载
**验收标准：**
- 工件管理器不支持打开的工件显示为下载链接，显示工件名
- 下载链接有明显的下载图标或标识
- 点击后直接下载工件文件

### 2.4 作为用户，我希望在工件管理器中看到工件的名称
**验收标准：**
- 工件列表中每个工件显示工件名而不是工件ID
- 打开工件时，标题栏显示工件名
- 工件名获取失败时显示工件ID作为降级方案

## 3. 功能需求

### 3.1 工件元数据批量获取
**需求描述：** 聊天面板需要从工件管理器批量获取工件的完整元数据信息

**详细说明：**
- 工件管理器提供接口，根据工件ID数组批量获取元数据
- 接口输入：工件ID数组 `string[]`
- 接口输出：Map对象，key为工件ID，value为该工件的完整元数据对象
- 元数据包含但不限于：MIME类型、工件名（用户可见的名称）、创建时间、扩展名等
- 获取失败的工件在Map中对应的value为null或不存在该key
- 支持空数组输入，返回空Map

### 3.2 MIME类型判断接口
**需求描述：** 工件管理器提供接口判断指定MIME类型是否可以打开

**详细说明：**
- 接口输入：MIME类型字符串
- 接口输出：布尔值，表示是否可以在工件管理器中打开
- 支持的类型包括：图片、JSON、文本、代码、HTML、CSS等

### 3.3 工件链接分组
**需求描述：** 根据工件类型将链接分为三组显示

**分组规则：**
1. **第一组：图片类型**
   - 显示缩略图
   - 支持点击放大查看
   - 包含的MIME类型：image/*

2. **第二组：可打开类型**
   - 显示为可点击链接，显示工件名
   - 点击后在工件管理器中打开
   - 包含的MIME类型：JSON、文本、代码、HTML、CSS等

3. **第三组：仅下载类型**
   - 显示为下载链接，显示工件名
   - 点击后直接下载
   - 包含的MIME类型：其他所有类型

### 3.4 工件名称显示
**需求描述：** 在所有显示工件的地方使用工件名而不是工件ID

**应用场景：**
1. **聊天面板工件链接**
   - 图片缩略图：显示工件名作为alt和title
   - 可打开链接：显示工件名作为链接文本
   - 下载链接：显示工件名作为链接文本

2. **工件管理器列表**
   - 图标视图：在图标下方显示工件名
   - 详情视图：在列表项中显示工件名
   - 工件名过长时截断并显示完整名称的tooltip

3. **工件查看器标题栏**
   - 打开工件时，标题栏显示工件名
   - 工件名获取失败时显示工件ID作为降级

### 3.5 UI展示要求
**需求描述：** 不同类型的工件有不同的展示样式

**展示规范：**
- 图片缩略图：固定尺寸（如100x100px），保持宽高比
- 可打开链接：使用主题色，带有文件图标，显示工件名
- 下载链接：使用次要色，带有下载图标，显示工件名
- 每组之间有明显的视觉分隔

## 4. 非功能需求

### 4.1 性能要求
- 元数据获取应该是异步的，不阻塞UI渲染
- 缩略图加载失败不影响其他内容显示
- 使用批量接口一次性获取多个工件的元数据，避免多次请求
- 工件管理器加载列表时批量获取所有工件的元数据

### 4.2 兼容性要求
- 保持与现有工件点击处理逻辑的兼容
- 不影响现有的工件管理器功能
- 支持工作空间文件的工件链接

### 4.3 可维护性要求
- MIME类型判断逻辑集中在工件管理器中
- 工件类型分组逻辑清晰，易于扩展
- 代码注释完整，说明设计意图

## 5. 技术约束

### 5.1 现有代码结构
- 聊天面板：`web/js/components/chat-panel.mjs`
- 工件管理器：`web/js/components/artifact-manager.mjs`
- MIME类型工具：`web/js/utils/mime-types.mjs`

### 5.2 依赖关系
- 聊天面板依赖工件管理器提供的接口
- 工件管理器依赖MIME类型工具判断类型
- 保持单例模式的工件管理器设计

## 6. 验收标准

### 6.1 功能验收
- [ ] 图片工件显示缩略图
- [ ] 可打开工件显示为链接，显示工件名
- [ ] 不可打开工件显示为下载链接，显示工件名
- [ ] 点击不同类型工件有正确的行为
- [ ] 元数据获取失败时有合理的降级处理
- [ ] 工件管理器列表显示工件名
- [ ] 工件查看器标题栏显示工件名
- [ ] 批量获取元数据接口正常工作

### 6.2 代码质量验收
- [ ] 代码符合项目规范
- [ ] 函数注释完整
- [ ] 没有重复代码
- [ ] 错误处理完善

### 6.3 用户体验验收
- [ ] 加载速度快，无明显卡顿
- [ ] 视觉效果清晰，分组明显
- [ ] 交互反馈及时
- [ ] 错误提示友好

## 7. 实现优先级

### P0（必须实现）
- 工件管理器提供MIME类型判断接口
- 工件管理器提供批量元数据获取接口（输入ID数组，返回Map）
- 聊天面板实现工件链接分组显示
- 工件管理器列表显示工件名
- 工件查看器标题栏显示工件名

### P1（应该实现）
- 图片缩略图显示
- 加载失败的降级处理
- 工件名过长时的截断和tooltip显示

### P2（可以实现）
- 缩略图懒加载
- 缓存元数据减少请求
- 更丰富的文件类型图标

## 8. 风险与依赖

### 8.1 技术风险
- 元数据获取可能失败，需要降级方案
- 大量工件时性能可能受影响
- 缩略图加载可能较慢

### 8.2 依赖项
- 工件管理器必须先实现相关接口
- MIME类型工具可能需要扩展
- 可能需要调整CSS样式

## 9. 后续优化方向

- 支持更多文件类型的预览
