# 模块管理窗口设计文档

## 1. 设计目标

设计一个符合系统规范的**可拖拽非模态窗口**，用于查看和管理已加载的模块。

## 2. 窗口结构规范

### 2.1 整体结构

```
┌─────────────────────────────────────────────────────────────┐
│ [≡] 模块管理                                    [_][□][×]  │  ← 标题栏 (可拖拽区域)
├──────────┬──────────────────────────────────────────────────┤
│          │                                                  │
│ 模块列表  │              模块管理页面                         │
│ (Sidebar)│            (Content Area)                        │
│          │                                                  │
│ • Chrome │  ┌──────────────────────────────────────────┐   │
│ • FFmpeg │  │                                          │   │
│ • SSH    │  │        模块管理界面内容                   │   │
│          │  │        (注入模块的 HTML)                  │   │
│          │  │                                          │   │
│          │  └──────────────────────────────────────────┘   │
│          │                                                  │
└──────────┴──────────────────────────────────────────────────┘
```

### 2.2 层级定义

| 层级 | 元素 | 说明 |
|------|------|------|
| L1 | Window Frame | 窗口外框，包含阴影、边框、圆角 |
| L2 | Title Bar | 标题栏，可拖拽区域 |
| L3 | Sidebar | 左侧模块列表区 |
| L4 | Content | 右侧管理页面内容区 |

## 3. 尺寸规范

### 3.1 窗口尺寸

| 属性 | 值 | 说明 |
|------|-----|------|
| 默认宽度 | 800px | 初始宽度 |
| 默认高度 | 600px | 初始高度 |
| 最小宽度 | 600px | 限制最小尺寸 |
| 最小高度 | 400px | 限制最小尺寸 |
| 最大宽度 | 90vw | 不超出视口90% |
| 最大高度 | 90vh | 不超出视口90% |

### 3.2 内部布局尺寸

| 区域 | 宽度 | 说明 |
|------|------|------|
| Sidebar | 200px | 固定宽度 |
| Content | flex: 1 | 自适应填充剩余空间 |
| 分隔线 | 1px | `border-r` 分隔 |

## 4. 视觉规范

### 4.1 颜色变量

| 元素 | 变量 | 用途 |
|------|------|------|
| 窗口背景 | `--surface-1` | 主背景色 |
| 标题栏背景 | `--surface-2` | 与内容区区分 |
| Sidebar 背景 | `--surface-2` | 次级背景 |
| 边框 | `--border` | 所有边框线 |
| 选中项 | `--primary-weak` | 选中模块背景 |
| 主文字 | `--text-1` | 标题、重要文字 |
| 次文字 | `--text-2` | 模块名称 |
| 辅助文字 | `--text-3` | 描述、图标 |

### 4.2 圆角与阴影

```css
/* 窗口外框 */
window-frame {
  border-radius: var(--radius-lg);  /* 12px */
  box-shadow: 0 20px 25px -5px var(--overlay),
              0 8px 10px -6px var(--overlay);
  border: 1px solid var(--border);
}

/* 标题栏 */
title-bar {
  border-bottom: 1px solid var(--border);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}
```

## 5. 标题栏规范

### 5.1 标题栏结构

```
┌─────────────────────────────────────────────────────────────┐
│ [≡] 模块管理                                    [_][□][×]  │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 标题栏元素

| 位置 | 元素 | 说明 |
|------|------|------|
| 左侧 | 拖拽图标 (≡) | GripVertical 图标，表示可拖拽 |
| 左中 | 窗口标题 | "模块管理"，font-semibold |
| 右侧 | 窗口控制按钮 | 最小化、最大化、关闭 |

### 5.3 窗口控制按钮

| 按钮 | 图标 | 行为 |
|------|------|------|
| 最小化 | `Minus` | 隐藏窗口到任务栏（后续实现）|
| 最大化 | `Maximize2` | 切换最大化/还原 |
| 关闭 | `X` | 关闭窗口 |

## 6. Sidebar 规范

### 6.1 Sidebar 结构

```
┌──────────────┐
│              │
│  [图标] 名称  │  ← 模块列表项
│  描述文字     │
│              │
├──────────────┤
│              │
│  [图标] 名称  │  ← 选中态 (高亮背景)
│  描述文字     │
│              │
└──────────────┘
```

### 6.2 模块列表项规范

| 属性 | 值 |
|------|-----|
| 内边距 | `p-3` (12px) |
| 图标大小 | `w-5 h-5` (20px) |
| 名称字号 | `text-sm` (14px) |
| 描述字号 | `text-xs` (12px) |
| 图标与文字间距 | `gap-2` (8px) |

### 6.3 状态样式

```css
/* 默认态 */
.module-item {
  color: var(--text-2);
  background: transparent;
}
.module-item:hover {
  background: var(--surface-3);
}

/* 选中态 */
.module-item.active {
  color: var(--primary);
  background: var(--primary-weak);
}
```

## 7. Content 区域规范

### 7.1 内容区结构

```
┌──────────────────────────────────────────┐
│ 模块显示名称                    [刷新]    │  ← 子标题栏
├──────────────────────────────────────────┤
│                                          │
│                                          │
│         模块管理页面内容                  │
│         (通过 v-html 注入)               │
│                                          │
│                                          │
└──────────────────────────────────────────┘
```

### 7.2 子标题栏

| 属性 | 值 |
|------|-----|
| 高度 | `h-12` (48px) |
| 背景 | `--surface-1` |
| 下边框 | `border-b border-[var(--border)]` |
| 标题字号 | `text-sm font-semibold` |
| 内边距 | `px-4` |

### 7.3 内容容器

| 属性 | 值 |
|------|-----|
| 背景 | `--surface-1` |
| 内边距 | `p-4` |
| 溢出 | `overflow-auto` |

## 8. 交互规范

### 8.1 拖拽交互

| 触发区域 | 行为 |
|----------|------|
| 标题栏 | 拖拽移动窗口 |
| 窗口边缘 | 调整大小（可选实现）|

### 8.2 拖拽约束

- 窗口不能拖出视口（保留 20px 边界）
- 拖拽时改变光标为 `cursor-move`
- 拖拽过程中添加半透明效果 `opacity-90`

### 8.3 窗口控制交互

| 操作 | 行为 |
|------|------|
| 点击关闭 | 关闭窗口（v-model = false）|
| 点击最大化 | 切换最大化状态 |
| 双击标题栏 | 最大化/还原 |

### 8.4 模块选择交互

| 操作 | 行为 |
|------|------|
| 点击模块项 | 加载并显示该模块管理页面 |
| 模块加载中 | 显示 loading 动画 |
| 模块加载失败 | 显示错误提示 |

## 9. 状态管理

### 9.1 窗口状态

```typescript
interface WindowState {
  // 显示/隐藏
  visible: boolean;
  
  // 位置
  x: number;
  y: number;
  
  // 尺寸
  width: number;
  height: number;
  
  // 最大化状态
  isMaximized: boolean;
  
  // 拖拽状态
  isDragging: boolean;
}
```

### 9.2 数据状态

```typescript
interface ModuleManagerState {
  // 模块列表
  modules: ModuleInfo[];
  
  // 当前选中模块
  selectedModule: ModuleInfo | null;
  
  // 当前模块的 Web 组件
  webComponent: ModuleWebComponent | null;
  
  // 加载状态
  loading: boolean;
  panelLoading: boolean;
}
```

## 10. 默认行为

### 10.1 初始状态

- 窗口默认不显示
- 默认位置：屏幕中央偏右 `(window.innerWidth - 800) / 2 + 100`
- 默认尺寸：800×600px
- 默认选中：第一个有管理界面的模块

### 10.2 记忆功能（可选）

- 记住窗口最后位置
- 记住最后选中的模块
- 使用 localStorage 存储

## 11. 响应式处理

### 11.1 窗口尺寸限制

```typescript
// 确保窗口不超出视口
const constrainToViewport = () => {
  const maxX = window.innerWidth - minVisibleWidth; // 100px
  const maxY = window.innerHeight - minVisibleHeight; // 50px
  
  windowX.value = Math.max(0, Math.min(windowX.value, maxX));
  windowY.value = Math.max(0, Math.min(windowY.value, maxY));
};
```

### 11.2 视口变化处理

- 窗口大小变化时，自动约束窗口位置
- 确保窗口始终可见

## 12. 现有实现问题

### 12.1 当前实现缺陷

1. **窗口结构不规范**
   - 缺少标准的标题栏结构
   - 没有窗口控制按钮（最小化/最大化/关闭）
   - 拖拽区域不明确

2. **尺寸不规范**
   - 当前 700×500px 偏小
   - 没有最大/最小尺寸限制

3. **视觉层级混乱**
   - Sidebar 和 Content 区域区分不明显
   - 缺少子标题栏

4. **交互不完整**
   - 缺少最大化功能
   - 缺少窗口记忆功能

### 12.2 需要改进的代码点

| 位置 | 问题 | 改进方案 |
|------|------|----------|
| 标题栏 | 只有关闭按钮 | 添加最小化、最大化按钮 |
| 尺寸 | 固定 700×500 | 改为 800×600，支持调整 |
| Sidebar | 背景色不明显 | 使用 `--surface-2` 区分 |
| Content | 缺少子标题栏 | 添加模块名称显示栏 |
| 拖拽 | 整个窗口可拖 | 仅限标题栏可拖 |

## 13. 实现检查清单

- [ ] 窗口尺寸 800×600px
- [ ] 标题栏包含拖拽图标、标题、控制按钮
- [ ] Sidebar 宽度 200px，背景 `--surface-2`
- [ ] Content 区域有子标题栏
- [ ] 支持拖拽移动（仅标题栏）
- [ ] 支持最大化/还原
- [ ] 选中模块高亮显示
- [ ] 加载状态有 loading 动画
- [ ] 窗口不超出视口边界
- [ ] 使用规范的颜色变量
- [ ] 遵循圆角和阴影规范
