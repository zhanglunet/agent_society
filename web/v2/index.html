<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能体工作台</title>
  <link rel="stylesheet" href="v2.css">
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div id="app" class="app">
    <aside class="global-sidebar">
      <div class="global-sidebar-header">
        <div class="global-title">组织</div>
        <div class="global-actions">
          <button id="sys-settings" class="icon-btn" type="button" title="设置">⚙️</button>
          <button id="sys-artifacts" class="icon-btn" type="button" title="工件">📦</button>
          <button id="sys-templates" class="icon-btn" type="button" title="组织模板">🏗️</button>
          <button id="sys-modules" class="icon-btn" type="button" title="模块">🔌</button>
        </div>
      </div>
      <div class="global-sidebar-body">
        <div id="org-list" class="org-list">
          <div class="placeholder">加载中...</div>
        </div>
      </div>
    </aside>

    <section class="workspace">
      <div class="workspace-tabs">
        <div id="tab-strip" class="tab-strip"></div>
      </div>

      <div class="workspace-body">
        <aside class="tab-sidebar">
          <div class="tab-sidebar-header">
            <div class="tab-sidebar-title">智能体</div>
          </div>
          <div id="agent-list" class="agent-list">
            <div class="placeholder">请选择组织或首页</div>
          </div>
        </aside>

        <main class="chat">
          <div id="org-view" class="org-view hidden">
            <div class="org-view-header">
              <div class="org-view-title">组织</div>
            </div>
            <div id="home-org-grid" class="home-org-grid"></div>
          </div>

          <div id="chat-view" class="chat-view">
            <div class="chat-header">
              <div class="chat-title">
                <span class="agent-name">请选择一个智能体</span>
                <span class="agent-role" style="display:none;"></span>
              </div>
              <div class="chat-header-actions">
                <div class="chat-status"></div>
                <button id="root-new-session-btn" class="btn-secondary" type="button" style="display:none;">新会话</button>
              </div>
            </div>

            <div id="message-list" class="message-list">
              <div class="placeholder">请选择一个智能体</div>
            </div>

            <div id="attachment-preview" class="attachment-preview-area"></div>

            <div class="chat-input-area">
              <div class="chat-input-buttons">
                <button id="image-upload-btn" class="upload-btn" title="上传图片" type="button">📷</button>
                <button id="file-upload-btn" class="upload-btn" title="上传文件" type="button">📎</button>
                <input type="file" id="image-input" accept="image/*" multiple style="display:none;">
                <input type="file" id="file-input" multiple style="display:none;">
              </div>
              <textarea id="chat-input" class="chat-textarea" rows="1" placeholder="输入消息（以 user 身份发送）..."></textarea>
              <button id="send-btn" class="btn-primary" type="button">发送</button>
            </div>
          </div>
        </main>
      </div>
    </section>
  </div>

  <script src="../js/api.js"></script>
  <script src="../js/utils/image-converter.js"></script>
  <script src="../js/utils/upload-service.js"></script>
  <script src="../js/components/toast.js"></script>
  <script src="../js/components/error-modal.js"></script>
  <script src="../js/components/llm-settings-modal.js"></script>
  <script src="../js/components/attachment-manager.js"></script>
  <script src="../js/components/modules-panel.js"></script>
  <script src="../js/components/org-templates-panel.js"></script>
  <script src="../js/components/image-viewer.js"></script>
  <script src="../js/utils/json-parser.js"></script>
  <script src="../js/components/json-viewer.js"></script>
  <script src="../js/components/text-viewer.js"></script>
  <script src="../js/components/thumbnail-navigator.js"></script>
  <script type="module" src="../js/components/chat-panel.mjs"></script>
  <script type="module" src="main.mjs"></script>

  <div id="toast-container" class="toast-container"></div>
  <div id="artifact-manager-window" class="artifact-window hidden">
    <div id="artifact-manager"></div>
  </div>
  <div id="org-templates-window" class="artifact-window org-templates-window hidden">
    <div class="org-templates-panel-header">
      <div class="org-templates-panel-title">🏗️ 组织模板</div>
      <div class="org-templates-panel-header-actions">
        <button id="org-templates-maximize-btn" class="window-btn maximize-btn" title="最大化/还原">⬜</button>
        <button id="org-templates-close-btn" class="window-btn close-btn" title="关闭">✕</button>
      </div>
    </div>
    <div class="org-templates-panel-body">
      <div class="org-templates-panel-sidebar">
        <div class="org-templates-panel-toolbar">
          <input id="org-templates-panel-search" type="text" placeholder="搜索 orgName / info..." />
          <button id="org-templates-panel-refresh-btn" class="btn-secondary" type="button">刷新</button>
        </div>
        <div id="org-templates-panel-list" class="org-templates-panel-list"></div>
        <div class="org-templates-panel-create">
          <input id="org-templates-panel-new-name" type="text" placeholder="orgName（字母数字_-）" />
          <button id="org-templates-panel-create-btn" class="btn-primary" type="button">新增</button>
        </div>
      </div>
      <div class="org-templates-panel-editor">
        <div class="org-templates-panel-editor-header">
          <div>当前：<span id="org-templates-panel-current-name">-</span></div>
          <div class="org-templates-panel-editor-actions">
            <button id="org-templates-panel-rename-btn" class="btn-secondary" type="button" disabled>重命名</button>
            <button id="org-templates-panel-save-all-btn" class="btn-primary" type="button" disabled>保存全部</button>
            <button id="org-templates-panel-delete-btn" class="btn-danger" type="button" disabled>删除</button>
          </div>
        </div>
        <div class="org-templates-panel-editor-section">
          <div class="org-templates-panel-editor-section-header">
            <div class="org-templates-panel-editor-section-title">info.md</div>
            <button id="org-templates-panel-save-info-btn" class="btn-primary" type="button" disabled>保存</button>
          </div>
          <textarea id="org-templates-panel-info-md" rows="10" placeholder="简介（用于匹配）..." disabled></textarea>
        </div>
        <div class="org-templates-panel-editor-section">
          <div class="org-templates-panel-editor-section-header">
            <div class="org-templates-panel-editor-section-title">org.md</div>
            <div class="org-templates-panel-editor-section-actions">
              <button id="org-templates-panel-reload-org-btn" class="btn-secondary" type="button" disabled>重新加载</button>
              <button id="org-templates-panel-save-org-btn" class="btn-primary" type="button" disabled>保存</button>
            </div>
          </div>
          <textarea id="org-templates-panel-org-md" rows="14" placeholder="完整组织架构内容（提示词）..." disabled></textarea>
        </div>
      </div>
    </div>
  </div>

  <div id="modules-window" class="artifact-window modules-window hidden">
    <div class="modules-window-header">
      <div class="modules-window-title">🔌 插件管理</div>
      <div class="modules-window-actions">
        <button id="modules-close-btn" class="window-btn close-btn" title="关闭">✕</button>
      </div>
    </div>
    <div class="modules-window-body">
      <div class="modules-panel">
        <div id="modules-list" class="modules-list"></div>
        <div id="module-detail" class="module-detail"></div>
      </div>
    </div>
  </div>
</body>
</html>
