## 问题定位结论
- 网页“总是在计算中”来自 `agent.computeStatus`，由后端 `RuntimeState.getAgentComputeStatus` 提供；当前调度器在 LLM 成功/工具执行时会把状态设为 `processing`，但回合结束后没有对称地设回 `idle`，导致 UI 长期显示“处理中/停止按钮”。
- “删除的智能体仍接收大模型回复并继续处理”主要是因为 `DELETE /api/agent/:id` 目前只做了 `org.recordTermination(...)`（软删除），没有触发运行时停止（abort epoch/取消 in-flight/清空队列/清 Turn）。因此运行时仍会继续调度该 agent，LLM 结果也会被正常接收与推进。
- “停止按钮报 400”是因为 `abortAgentLlmCall` 在 agent 不存在时返回 `{ok:false}` 但不带 `reason`；HTTP 层按 `reason !== 'agent_not_found'` 分支回 400，导致前端看见 400。

## 修复方案
### 1) 回合结束时自动把 computeStatus 归位为 idle
- 在 `ComputeScheduler` 增加一个统一的“状态收敛”函数（例如 `_maybeSetIdle(agentId)`）：当满足以下条件时把 computeStatus 设为 `idle`：
  - 不在 `_inFlight`；
  - `TurnEngine.hasRunnable(agentId)` 为 false；
  - `bus.getQueueDepth(agentId) === 0`；
  - 当前状态不在 `stopping/stopped/terminating`。
- 在 `_runOneStep()` 处理 `outcome.kind === 'done' | 'send'` 后调用该函数。
- 在 LLM/tool 的 `finally` 中也调用该函数（尤其是 epoch 不匹配被丢弃的场景），避免“被取消但仍停留在 waiting_llm/processing”。

### 2) 删除智能体时同步终止运行时（停止接收/停止推进）
- 给 Runtime/Lifecycle 增加一个“管理员/HTTP 侧强制终止”入口（例如 `runtime.forceTerminateAgent(agentId, deletedBy, reason)`）：
  - 将 computeStatus 置为 `terminating`；
  - `cancelManager.abort(agentId, {reason:'http_delete'})` + `llm.abort(agentId)`，确保晚到结果被 epoch 丢弃；
  - `bus.clearQueue(agentId)`；
  - 清理 TurnEngine 里的 turn（新增 `turnEngine.clearAgent(agentId)` 或等价逻辑：删除 entry/activeTurn/queue）；
  - 从运行时 Map 中移除该 agent（_agents/_conversations/_agentMetaById 等），并清理 cancelManager 记录。
- 在 `HTTPServer._handleDeleteAgent` 的 200 分支里调用该强制终止（或在 recordTermination 前后都可，但需要保证强制终止失败时返回明确错误）。

### 3) 让调度器对“已不存在/已终止”agent 更健壮
- 在 `ComputeScheduler._runOneStep()` 取到 agentId 后，若 `runtime._agents` 不存在该 agent：
  - 直接丢弃其 ready 标记；
  - 调用 `turnEngine.clearAgent(agentId)`；
  - 从 `_inFlight` 删除该 agent（如果存在）；
  - 将 computeStatus 归位为 `idle`/或清理状态。
- 在 LLM/tool 回调中，在处理 `onLlmResult/onToolResult` 前增加存在性与终止态检查，不满足则直接忽略并清理。

### 4) 修复停止按钮 400：agent 不存在应返回 404
- 修改 `RuntimeLifecycle.abortAgentLlmCall`：当 agent 不存在时返回 `{ok:false, aborted:false, reason:'agent_not_found'}`。
- 保持 HTTP 层逻辑不变即可让前端看到 404，并且返回体 `error` 有值。

## 测试补齐（回归覆盖）
- 新增单测：一个 turn 完成后 computeStatus 会回到 `idle`（构造 LLM 返回纯文本、跑完 step，断言状态）。
- 新增单测：`abortAgentLlmCall` 对不存在 agent 返回 `reason:'agent_not_found'`。
- 新增单测：HTTP delete/forceTerminate 后：
  - agent 从运行时移除；
  - 队列清空；
  - TurnEngine 无残留；
  - 之后即使 LLM promise resolve，也不会触发后续推进（epoch 丢弃）。

## 预计改动文件
- `src/platform/runtime/compute_scheduler.js`
- `src/platform/runtime/turn_engine.js`（增加 clearAgent/reset API）
- `src/platform/runtime/runtime_lifecycle.js`（abort reason + forceTerminate API）
- `src/platform/services/http/http_server.js`（delete 调用 forceTerminate）
- `test/platform/*.test.js`（新增上述回归测试）