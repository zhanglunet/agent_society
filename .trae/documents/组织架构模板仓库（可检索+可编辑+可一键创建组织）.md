## 需求清单（按你最新确认）
- 智能体侧：
  1) 工具函数：读取所有模板的 `info.md` 列表（用于匹配）。
  2) 工具函数：按 `orgName` 读取 `org.md` 详细内容（用于创建组织，可自行修改后再用）。
- 用户侧（Web 设置页）：
  - 查看所有组织模板（orgName + info.md 摘要）。
  - 查看并编辑某个模板的两个文件：`info.md` 与 `org.md`。
  - 新增组织模板（创建 `org/[orgName]/` 与两文件）。
  - 删除组织模板（删除 `org/[orgName]/` 目录）。
- 关键约束：加载时机分离
  - 列表/匹配：只读 `info.md`
  - 详情/编辑 org：按 orgName 才读 `org.md`

## 存储结构（固定）
- `org/[orgName]/info.md`
- `org/[orgName]/org.md`

## 后端实现（单一仓库模块 + 两类入口）
### 1) 文件系统仓库模块（唯一读写入口）
- 扫描目录：仅列出 `org/` 的一级子目录名作为 orgName，不读取文件。
- 读取/写入接口严格按文件拆分：
  - `listTemplateInfos()`：读取每个模板的 `info.md`，返回 `[{ orgName, infoMd }]`（不读取 org.md）。
  - `readInfo(orgName)` / `writeInfo(orgName, infoMd)`。
  - `readOrg(orgName)` / `writeOrg(orgName, orgMd)`。
  - `createTemplate(orgName)`：创建目录与空的 `info.md/org.md`（内容后续分别写）。
  - `deleteTemplate(orgName)`：删除 `org/[orgName]/` 目录（限制在 org 根目录下）。
- 安全与错误：
  - orgName 只允许 `[A-Za-z0-9_-]`。
  - 写入用原子写（临时文件 + rename）。
  - 缺失 `info.md`：在列表中跳过该模板并记录日志；缺失 `org.md`：readOrg 返回 not_found。

### 2) 智能体工具函数（Tools）
- `list_org_template_infos`：无参数；返回 `{ templates: [{ orgName, infoMd }] }`；只读 info.md。
- `get_org_template_org`：参数 `{ orgName }`；返回 `{ orgName, orgMd }`；只读 org.md。
- 工具权限：两个工具都映射到 `org_management` 工具组，保证 root 可用。

### 3) Web 设置页所需 HTTP API（同样按文件拆分）
- 列表（只读 info）：
  - `GET /api/org-templates` → `{ templates: [{ orgName, infoExcerpt, infoUpdatedAt }] }`
- 单文件读取：
  - `GET /api/org-templates/:orgName/info`
  - `GET /api/org-templates/:orgName/org`
- 单文件更新：
  - `PUT /api/org-templates/:orgName/info`
  - `PUT /api/org-templates/:orgName/org`
- 新增与删除：
  - `POST /api/org-templates` body `{ orgName }`
  - `DELETE /api/org-templates/:orgName`
- 说明：列表与编辑完全解耦，列表接口不读 org.md。

## 前端实现（放在“设置”里）
- 在现有设置弹窗增加一个新 tab：`组织模板`。
- Tab 内容：
  - 左侧：模板列表（orgName + info 摘要），搜索框（前端对 orgName/info 摘要过滤；不触发 org.md 加载）。
  - 右侧：选中模板的详情编辑区：
    - `info.md` 编辑（默认立即加载）
    - `org.md` 编辑（用户切到“完整架构”区域/按钮时懒加载）
    - 两个保存按钮分别保存各自文件。
  - 新增：输入 orgName → 调用 POST 创建 → 自动选中进入编辑。
  - 删除：选中模板点击删除 → 二次确认 → 调用 DELETE → 刷新列表。

## 测试计划（bun test）
- 仓库模块：扫描、非法 orgName、缺失文件、原子写、删除目录边界。
- 工具函数：
  - list 只读 info，返回结构正确。
  - get_org 读 org.md，错误分支正确。
  - root 工具组包含新工具。
- HTTP：list/get/put/post/delete 的成功与失败分支。
- Web：设置 tab 渲染、懒加载行为（打开不请求 org.md）、保存/新增/删除流程。

## 实施顺序（小步可见）
1. 仓库模块 + 两个智能体工具函数 + 工具组映射 + 单测。
2. 增加 HTTP API（按文件拆分）+ 单测。
3. 设置弹窗增加“组织模板”tab：列表 + 懒加载编辑 + 新增/删除。
4. 增补 Web 交互测试。
